> JavaScript 是单线程

## 什么是宏任务和微任务

- 微任务是指在当前任务执行结束后立即执行的任务，它可以看作是在当前任务的“尾巴”添加的任务。

​ 常见的微任务包括 ：Promise then/catch 回调函数、process.nextTick、Object.observe（已废弃）、MutationObserver。

- 宏任务是指需要排队等待 JavaScript 引擎空闲时才能执行的任务。

​ 常见的宏任务包括 ：setTimeout、setInterval、setImmediate（Node.js 独有）、requestAnimationFrame、I/O 操作、UI 渲染。

## 执行顺序

JavaScript 引擎会先执行当前任务中的所有**微任务**，然后再执行宏任务队列中的第一个任务。这个过程会不断重复，直到宏任务队列中的任务被全部执行完毕。

1. 执行同步任务，遇到宏任务/微任务时，将其加到宏/微任务队列中
2. 执行所有的微任务队列中的任务，直到微任务队列为空
3. 执行宏任务队列中的第一个任务，直到宏任务队列为空
4. 重复 2 和 3，直到所有任务都被执行完毕
   ![eventloop](/notes/imgs/eventloop.gif)
   **注意：微任务比宏任务优先级要高，因此在同一个任务中，如果既有微任务又有宏任务，那么微任务会先执行完毕。而在不同的任务中，宏任务的执行优先级要高于微任务，因此在一个宏任务执行完毕后，它才会执行下一个宏任务和微任务队列中的任务。**
