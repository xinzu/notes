<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>编译器 | yh的学习文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/notes/assets/css/0.styles.aa6162e3.css" as="style"><link rel="preload" href="/notes/assets/js/app.960a29f6.js" as="script"><link rel="preload" href="/notes/assets/js/2.c60e90e7.js" as="script"><link rel="preload" href="/notes/assets/js/38.8dd277ae.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.23d8a2ac.js"><link rel="prefetch" href="/notes/assets/js/11.de7ccc4b.js"><link rel="prefetch" href="/notes/assets/js/12.74d38aed.js"><link rel="prefetch" href="/notes/assets/js/13.086d0aa7.js"><link rel="prefetch" href="/notes/assets/js/14.e757a9f7.js"><link rel="prefetch" href="/notes/assets/js/15.c729cc0d.js"><link rel="prefetch" href="/notes/assets/js/16.5d640bd3.js"><link rel="prefetch" href="/notes/assets/js/17.383d709e.js"><link rel="prefetch" href="/notes/assets/js/18.1ffa3e7f.js"><link rel="prefetch" href="/notes/assets/js/19.f64d0f09.js"><link rel="prefetch" href="/notes/assets/js/20.7f9dd61b.js"><link rel="prefetch" href="/notes/assets/js/21.14c7ae29.js"><link rel="prefetch" href="/notes/assets/js/22.6a3eab26.js"><link rel="prefetch" href="/notes/assets/js/23.aefb6dae.js"><link rel="prefetch" href="/notes/assets/js/24.291b1c00.js"><link rel="prefetch" href="/notes/assets/js/25.d36a9745.js"><link rel="prefetch" href="/notes/assets/js/26.41bbb53a.js"><link rel="prefetch" href="/notes/assets/js/27.8b81ebae.js"><link rel="prefetch" href="/notes/assets/js/28.552362a1.js"><link rel="prefetch" href="/notes/assets/js/29.671012b1.js"><link rel="prefetch" href="/notes/assets/js/3.fb28e9ff.js"><link rel="prefetch" href="/notes/assets/js/30.0a55c014.js"><link rel="prefetch" href="/notes/assets/js/31.0125f057.js"><link rel="prefetch" href="/notes/assets/js/32.7a87445e.js"><link rel="prefetch" href="/notes/assets/js/33.59075755.js"><link rel="prefetch" href="/notes/assets/js/34.d64a5591.js"><link rel="prefetch" href="/notes/assets/js/35.fb6fbca6.js"><link rel="prefetch" href="/notes/assets/js/36.6791176b.js"><link rel="prefetch" href="/notes/assets/js/37.8e215606.js"><link rel="prefetch" href="/notes/assets/js/39.13f36383.js"><link rel="prefetch" href="/notes/assets/js/4.b7d0708f.js"><link rel="prefetch" href="/notes/assets/js/40.5a78ab94.js"><link rel="prefetch" href="/notes/assets/js/41.eeb6e5e0.js"><link rel="prefetch" href="/notes/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/notes/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/notes/assets/js/7.eed962d3.js"><link rel="prefetch" href="/notes/assets/js/8.fb5a3d35.js"><link rel="prefetch" href="/notes/assets/js/9.d7d00d31.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.aa6162e3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">yh的学习文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础知识扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/notes/typescript/ts.html" class="sidebar-link">typescript</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>工具类</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/工具类/fiddler工具使用.html" class="sidebar-link">fiddler</a></li><li><a href="/notes/工具类/node-翻译工具.html" class="sidebar-link">node包开发</a></li><li><a href="/notes/工具类/JavaScript开发工具的生态.html" class="active sidebar-link">JavaScript开发工具的生态</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#swc" class="sidebar-link">swc</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#上层工具" class="sidebar-link">上层工具</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#基本使用" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#node-apis" class="sidebar-link">Node APIS</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#打包代码" class="sidebar-link">打包代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#esbuild" class="sidebar-link">esbuild</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#上层工具-2" class="sidebar-link">上层工具</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#对比现有打包工具" class="sidebar-link">对比现有打包工具</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#安装-2" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#esbuild-api" class="sidebar-link">esbuild API</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#代码打包" class="sidebar-link">代码打包</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#在-webpack-中使用-esbuild" class="sidebar-link">在 webpack 中使用 esbuild</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#babel-vs-tsc" class="sidebar-link">babel vs tsc</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#打包器" class="sidebar-link">打包器</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#browserify" class="sidebar-link">browserify</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#webpack" class="sidebar-link">webpack</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#rollup" class="sidebar-link">rollup</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#parcel" class="sidebar-link">parcel</a></li><li class="sidebar-sub-header"><a href="/notes/工具类/JavaScript开发工具的生态.html#其他" class="sidebar-link">其他</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="编译器"><a href="#编译器" class="header-anchor">#</a> 编译器</h1> <blockquote><p>编译器负责将输入的代码，转换为某种目标的输出格式</p></blockquote> <p>以下是关于 JS 和 TS 的编译器，它可以将现代的 JS 和 TS 转换成特定版本的 ECMAscript，并兼容浏览器和最新版本的 Node.js。</p> <p>编译器从 <code>tsc</code> 和 <code>babel</code> 到 <code>swc</code> 和 <code>esbuild</code>，遗憾的是 swc 和 esbuild 都<strong>不能类型检查</strong>，它们只会尽可能的提速。如果项目正在使用 TS，最好还是在工具链中使用 tsc 来进行类型检查。</p> <p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/js&amp;ts%E7%BC%96%E8%AF%91%E5%99%A8.png" alt="编译器"></p> <h2 id="swc"><a href="#swc" class="header-anchor">#</a> swc</h2> <p><a href="#https://swc.rs/docs/getting-started">swc 官方文档</a></p> <blockquote><p>swc 是用 rust 编写的 super-fasttypescript/javascript 编译器。</p></blockquote> <h3 id="上层工具"><a href="#上层工具" class="header-anchor">#</a> 上层工具</h3> <ul><li>Vercel 和 Next.js</li> <li>Deno 的 linter，formatter 和 docs</li> <li>Parcel</li> <li>nx</li></ul> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <ul><li>@swc/cli 类似于 @babel/cli;</li> <li>@swc/core 类似于 @babel/core;</li></ul> <div class="language- extra-class"><pre class="language-text"><code>npm i -D @swc/core @swc/cli
</code></pre></div><p>或者</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add --dev @swc/core @swc/cli
</code></pre></div><h3 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 文件</span>
npx swc ./file.js -o output.js
<span class="token comment"># 文件夹</span>
npx swc ./my-dir -d output
</code></pre></div><p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/swc.png" alt="image-20220507111345794"></p> <p>index.js 代码中使用了 ES6 的两个特性，const 声明 和 箭头函数。经过 swc 转化后，这两个特性分别被转化成了 var 声明 和 function 匿名函数</p> <p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/swc-dist.png" alt="image-20220507111401505"></p> <h3 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h3> <p><code>.swcrc</code>，类似于<code>.babelrc</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;jsc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// 编译规则</span>
		<span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 输出js的规范</span>
		<span class="token property">&quot;parser&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token comment">// 除了 ecmascript，还支持 typescript</span>
			<span class="token property">&quot;syntax&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ecmascript&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 是否解析jsx，对应插件 @babel/plugin-transform-react-jsx</span>
			<span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否支持装饰器，对应插件 @babel/plugin-syntax-decorators</span>
			<span class="token property">&quot;decorators&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否支持动态导入，对应插件 @babel/plugin-syntax-dynamic-import</span>
			<span class="token property">&quot;dynamicImport&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// …… // babel 的大部分插件都能在这里找到对应配置</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;minify&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 压缩相关配置，需要先开启压缩</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// 编译结果相关配置</span>
		<span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token comment">// 编译结果需要适配的浏览器</span>
			<span class="token property">&quot;ie&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11&quot;</span> <span class="token comment">// 只兼容到 ie 11</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3&quot;</span> <span class="token comment">// corejs 的版本</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;minify&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 是否开启压缩</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="node-apis"><a href="#node-apis" class="header-anchor">#</a> Node APIS</h3> <p>通过在 node.js 代码中，导入 @swc/core 模块，可以在 node.js 中调用 api 直接进行代码的编译，这对 CLI 工具的开发来说是常规操作。</p> <div class="language- extra-class"><pre class="language-text"><code>// swc.mjs 
import { readFileSync } from 'fs' 
import { transform } from '@swc/core' 
 
const run = async () =&gt; { 
  const code = readFileSync('./source.js', 'utf-8') 
 const result = await transform(code, { 
    filename: &quot;source.js&quot;, 
  }) 
  // 输出编译后代码 
  console.log(result.code) 
} 
 
run() 
</code></pre></div><p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/swc-node.png" alt="image-20220507111713986"></p> <h3 id="打包代码"><a href="#打包代码" class="header-anchor">#</a> 打包代码</h3> <p>除了将代码转义，swc 还提供了一个简易的打包能力。</p> <div class="language- extra-class"><pre class="language-text"><code>npx spack
</code></pre></div><p><code>spack.config.js</code>，swc 打包的配置文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// spack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// 打包的入口</span>
		<span class="token literal-property property">web</span><span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">&quot;/src/index.js&quot;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// 打包后输出的文件夹</span>
		<span class="token literal-property property">path</span><span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">&quot;/dist&quot;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/spack.png" alt="image-20220507112518488"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> log <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;app started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// src/utils.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">errorLog</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>打包成功后，会在 dist 目录输出一个 web.js 文件。打包后的代码还进行了 tree shaking，将 utils.js 中没有使用的 errorLog 方法删掉了。</p> <p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/spack-result.png" alt="image-20220507112649555"> <img src="/notes/imgs/JS生态工具/spack-web.png" alt="image-20220507112744029" style="zoom:67%;"></p> <h2 id="esbuild"><a href="#esbuild" class="header-anchor">#</a> esbuild</h2> <blockquote><p>它是一个「JavaScript」Bundler 打包和压缩工具，它可以将 JavaScript 和 TypeScript 代码打包分发在网页上运行。</p></blockquote> <h3 id="上层工具-2"><a href="#上层工具-2" class="header-anchor">#</a> 上层工具</h3> <ul><li>Vite</li> <li>Nuxt.js</li> <li>Remix</li> <li>SvelteKit</li> <li>tsup</li></ul> <p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/esbuild.png" alt="esbuild压缩速度大幅提升"></p> <h3 id="对比现有打包工具"><a href="#对比现有打包工具" class="header-anchor">#</a> 对比现有打包工具</h3> <blockquote><p>esbuild」的作者对比目前现阶段类似的工具做了<strong>基准测试</strong>。最后的结果是：</p> <p>​ 对于这些基准测试，esbuild 比其他 JavaScript 打包程序 快至少 100 倍。</p></blockquote> <h4 id="官方解释"><a href="#官方解释" class="header-anchor">#</a> 官方解释</h4> <ul><li>它是用「Go」语言编写的，该语言可以编译为本地代码。</li> <li>解析，生成最终文件和生成 source maps 全部完全并行化。</li> <li>无需昂贵的数据转换，只需很少的几步即可完成所有操作。</li> <li>该库以提高编译速度为编写代码时的第一原则，并尽量避免不必要的内存分配。</li></ul> <h3 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> esbuild
</code></pre></div><h3 id="esbuild-api"><a href="#esbuild-api" class="header-anchor">#</a> esbuild API</h3> <h4 id="transform"><a href="#transform" class="header-anchor">#</a> transform</h4> <p>transform 可以用于转化 .js、.tsx、ts 等文件，然后输出为旧的语法的 .js 文件，它提供了两个参数：</p> <p>第一个参数（必填，字符串），指需要转化的代码（模块内容）。
第二个参数（可选），指转化需要的选项，如源文件路径 sourcefile、需要加载的 loader，其中 loader 的定义：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Loader</span> <span class="token operator">=</span>
	<span class="token operator">|</span> <span class="token string">&quot;js&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;jsx&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;ts&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;tsx&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;css&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;json&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;text&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;base64&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;file&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;dataurl&quot;</span>
	<span class="token operator">|</span> <span class="token string">&quot;binary&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="transfromsync"><a href="#transfromsync" class="header-anchor">#</a> transfromSync</h4> <p>transform 的同步方法</p> <h4 id="build"><a href="#build" class="header-anchor">#</a> build</h4> <p><code>build</code> 实现了 <code>transform</code> 的能力，即代码转化，并且它还会将转换后的代码压缩并生成 <code>.js</code> 文件到指定 <code>output</code> 目录。<code>build</code> 只提供了一个参数（对象），来指定需要转化的入口文件、输出文件、<code>loader</code> 等选项：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">BuildOptions</span> <span class="token keyword">extends</span> <span class="token class-name">CommonOptions</span> <span class="token punctuation">{</span>
	bundle<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	splitting<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	outfile<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 输出文件路径</span>
	metafile<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	outdir<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 输出地址</span>
	platform<span class="token operator">?</span><span class="token operator">:</span> Platform<span class="token punctuation">;</span>
	color<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	external<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	loader<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>ext<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> Loader <span class="token punctuation">}</span><span class="token punctuation">;</span>
	resolveExtensions<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	mainFields<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	write<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
	tsconfig<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	outExtension<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>ext<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	entryPoints<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 入口文件路径</span>
	stdin<span class="token operator">?</span><span class="token operator">:</span> StdinOptions<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="buildsync"><a href="#buildsync" class="header-anchor">#</a> buildSync</h4> <p>build 的同步方法</p> <h4 id="service"><a href="#service" class="header-anchor">#</a> Service</h4> <blockquote><p><code>Service</code> 的出现是为了解决调用上述 API 时都会创建一个子进程来完成的问题，如果存在多次调用 API 的情况出现，那么就会出现性能上的浪费。</p> <p>所以，使用了 <code>Service</code> 来实现代码的转化或打包，则会创建一个长期的用于共享的子进程，避免了性能上的浪费。而在「Vite」中也正是使用 <code>Service</code> 的方式来进行 <code>.ts</code>、<code>.js</code>、<code>.jsx</code> 代码的转化工作。</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// Service定义</span>
<span class="token keyword">interface</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>
	<span class="token function">build</span><span class="token punctuation">(</span>options<span class="token operator">:</span> BuildOptions<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>BuildResult<span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">transform</span><span class="token punctuation">(</span>
		input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
		options<span class="token operator">?</span><span class="token operator">:</span> TransformOptions
	<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>TransformResult<span class="token operator">&gt;</span><span class="token punctuation">;</span>
	<span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用时startService报错，可能是版本问题，待验证</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> startService<span class="token punctuation">,</span> build <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;esbuild&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">startService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">entryPoints</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/main.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">write</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
	service<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>在使用 <code>stop</code> 的时候需要注意，它会结束这个子进程，这也意味着任何在此时处于 <code>pending</code> 的 <code>Promise</code> 也会被终止。</strong></p> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p><a href="#https://juejin.cn/post/6918927987056312327">esbuild 使用介绍</a></p> <h4 id="writefilesync-writefile"><a href="#writefilesync-writefile" class="header-anchor">#</a> writeFileSync/writeFile</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// file.js</span>
<span class="token comment">// 生成in.ts文件</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;in.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;let x: number =   1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 编译in.ts 生成 out.js</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;esbuild&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildSync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">entryPoints</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;in.ts&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">outfile</span><span class="token operator">:</span> <span class="token string">&quot;out.js&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>​ 执行<code>node file.js</code> 生成 <code>in.ts</code> 和 <code>out.js</code> 两个文件</p> <p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/esbuild-file.png" alt="writeFileSync/writeFile 结果"></p> <h4 id="处理-jsx-代码"><a href="#处理-jsx-代码" class="header-anchor">#</a> 处理 jsx 代码</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;esbuild&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transformSync</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;div/&gt;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">jsxFactory</span><span class="token operator">:</span> <span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;jsx&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 将 loader 设置为 jsx 可以编译 jsx 代码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/esbuild-jsx.png" alt="jsx处理结果"></p> <h4 id="代码压缩"><a href="#代码压缩" class="header-anchor">#</a> 代码压缩</h4> <div class="language- extra-class"><pre class="language-text"><code>var js = 'fn = obj =&gt; { return obj.x }'
const res = require('esbuild').transformSync(js, {
  minify: true,
})
</code></pre></div><p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/esbuild-minify.png" alt="代码压缩结果"></p> <h3 id="代码打包"><a href="#代码打包" class="header-anchor">#</a> 代码打包</h3> <p><code>/src/index.js</code> 和 <code>/src/util.js</code> 和<a href="#%E6%89%93%E5%8C%85%E4%BB%A3%E7%A0%81">swc</a>中的一样</p> <p><img src="/notes/imgs/JS%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7/esbuild-result.png" alt="image-20220507145918226"></p> <h3 id="在-webpack-中使用-esbuild"><a href="#在-webpack-中使用-esbuild" class="header-anchor">#</a> 在 webpack 中使用 esbuild</h3> <p>在 plugins 中引用<code>esbuild-plugin</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> ESBuildPlugin<span class="token punctuation">,</span> ESBuildMinifyPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'esbuild-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 用 esbuild 代替 babel-loader（ts-loader同理） 做代码降级</span>
    <span class="token punctuation">{</span>
    	<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'esbuild-loader'</span><span class="token punctuation">,</span>
    	<span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    		<span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'jsx'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'es2015'</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 用 esbuild 代替 ts-loader 处理 ts 代码</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.tsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'esbuild-loader'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'jsx'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'es2015'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token comment">// 用于minify代码</span>

    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">ESBuildPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">ESBuildMinifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'es2015'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="babel-vs-tsc"><a href="#babel-vs-tsc" class="header-anchor">#</a> babel vs tsc</h2> <ul><li><p>babel 无法做到类型检查，三克油使用<code>tsc --noEmit</code>单独检查类型</p></li> <li><p>ts 无法自动 polyfill</p> <p>Babel 的<code>@babel/polyfill</code>模块包含了<code>core-js</code></p> <p>TS 只能通过<code>tsconfig</code>的<code>target</code>控制编译为对应 ECMAScript 版本的语法。比如 const/let 变 var，箭头函数变 function，async+await 变 Promise.then 这些，<strong>不会引入内置对象的扩展</strong>，比如你要运行的浏览器不支持 Promise，编译后也不会带一个完整的 Promise polyfill，想 polyfill 还是得配合 <code>core-js</code></p></li> <li><p>babel 扩展性更强，有更丰富的社区生态（各种各样的插件）</p></li> <li><p>babel 支持更多语言特性</p></li> <li><p>babel 产物体积更小</p></li></ul> <p>如果项目中，已有 Babel 和 TypeScript，最好使用 Babel 编译代码，使用 TS 进行类型检查和生成<code>.d.ts</code>文件</p> <h2 id="打包器"><a href="#打包器" class="header-anchor">#</a> 打包器</h2> <h2 id="browserify"><a href="#browserify" class="header-anchor">#</a> browserify</h2> <p><strong>浏览器端</strong>的前端打包工具</p> <h2 id="webpack"><a href="#webpack" class="header-anchor">#</a> webpack</h2> <h2 id="rollup"><a href="#rollup" class="header-anchor">#</a> rollup</h2> <h2 id="parcel"><a href="#parcel" class="header-anchor">#</a> parcel</h2> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <p><code>swc</code>和<code>esbuild</code>都具备打包功能，但功能还不够全面</p> <h1 id="包管理器"><a href="#包管理器" class="header-anchor">#</a> 包管理器</h1> <h1 id="第三方库开发"><a href="#第三方库开发" class="header-anchor">#</a> 第三方库开发</h1> <h1 id="web-应用开发"><a href="#web-应用开发" class="header-anchor">#</a> Web 应用开发</h1></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/工具类/node-翻译工具.html" class="prev">
        node包开发
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.960a29f6.js" defer></script><script src="/notes/assets/js/2.c60e90e7.js" defer></script><script src="/notes/assets/js/38.8dd277ae.js" defer></script>
  </body>
</html>
