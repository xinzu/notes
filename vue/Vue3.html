<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从vue2中迁移 | yh的学习文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/notes/assets/css/0.styles.e06a72d3.css" as="style"><link rel="preload" href="/notes/assets/js/app.618cb3ee.js" as="script"><link rel="preload" href="/notes/assets/js/2.c60e90e7.js" as="script"><link rel="preload" href="/notes/assets/js/17.87ca5149.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.43f9523c.js"><link rel="prefetch" href="/notes/assets/js/11.eac03512.js"><link rel="prefetch" href="/notes/assets/js/12.2af14a65.js"><link rel="prefetch" href="/notes/assets/js/13.1e5b7d9d.js"><link rel="prefetch" href="/notes/assets/js/14.face8e74.js"><link rel="prefetch" href="/notes/assets/js/15.ce08361f.js"><link rel="prefetch" href="/notes/assets/js/16.66ae9248.js"><link rel="prefetch" href="/notes/assets/js/18.3531425e.js"><link rel="prefetch" href="/notes/assets/js/19.14bce33a.js"><link rel="prefetch" href="/notes/assets/js/20.f5349154.js"><link rel="prefetch" href="/notes/assets/js/21.3104953e.js"><link rel="prefetch" href="/notes/assets/js/22.4652cbe2.js"><link rel="prefetch" href="/notes/assets/js/23.b29d8cce.js"><link rel="prefetch" href="/notes/assets/js/24.9392141b.js"><link rel="prefetch" href="/notes/assets/js/25.43c4d126.js"><link rel="prefetch" href="/notes/assets/js/26.d3c76fcd.js"><link rel="prefetch" href="/notes/assets/js/27.e106e519.js"><link rel="prefetch" href="/notes/assets/js/28.ff6f6a8f.js"><link rel="prefetch" href="/notes/assets/js/29.7b65abb1.js"><link rel="prefetch" href="/notes/assets/js/3.7fa024a0.js"><link rel="prefetch" href="/notes/assets/js/30.f0de7750.js"><link rel="prefetch" href="/notes/assets/js/4.ed8f2e2d.js"><link rel="prefetch" href="/notes/assets/js/5.32dde0b2.js"><link rel="prefetch" href="/notes/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/notes/assets/js/7.03139e79.js"><link rel="prefetch" href="/notes/assets/js/8.fb5a3d35.js"><link rel="prefetch" href="/notes/assets/js/9.1de6ed85.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.e06a72d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">yh的学习文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础知识扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/vue/vue.html" class="sidebar-link">vue2</a></li><li><a href="/notes/vue/Vue的一些高级用法.html" class="sidebar-link">vue2的一些高级用法</a></li><li><a href="/notes/vue/Vue3.html" aria-current="page" class="active sidebar-link">vue3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#从vue2中迁移" class="sidebar-link">从vue2中迁移</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#v-for中的ref数组" class="sidebar-link">v-for中的Ref数组</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#异步组件" class="sidebar-link">异步组件</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#attrs" class="sidebar-link">$attrs</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#children" class="sidebar-link">$children</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#自定义元素" class="sidebar-link">自定义元素</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#is动态组件" class="sidebar-link">is动态组件</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#data选项" class="sidebar-link">data选项</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#emit选项" class="sidebar-link">emit选项</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#移除过滤器" class="sidebar-link">移除过滤器</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#支持多个根节点" class="sidebar-link">支持多个根节点</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#监听组件生命周期" class="sidebar-link">监听组件生命周期</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#指令" class="sidebar-link">指令</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#按键修饰符" class="sidebar-link">按键修饰符</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#移除-listener" class="sidebar-link">移除$listener</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#移除内联模版" class="sidebar-link">移除内联模版</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#propsdata" class="sidebar-link">propsData</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#插槽统一" class="sidebar-link">插槽统一</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#过渡的class名更改" class="sidebar-link">过渡的class名更改</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#api改动" class="sidebar-link">API改动</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#vue3快速上手" class="sidebar-link">Vue3快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_1-vue3简介" class="sidebar-link">1.Vue3简介</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_2-vue3带来了什么" class="sidebar-link">2.Vue3带来了什么</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#一、创建vue3-0工程" class="sidebar-link">一、创建Vue3.0工程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_1-使用-vue-cli-创建" class="sidebar-link">1.使用 vue-cli 创建</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_2-使用-vite-创建" class="sidebar-link">2.使用 vite 创建</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#二、常用-composition-api" class="sidebar-link">二、常用 Composition API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_1-拉开序幕的setup" class="sidebar-link">1.拉开序幕的setup</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_2-ref函数" class="sidebar-link">2.ref函数</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_3-reactive函数" class="sidebar-link">3.reactive函数</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_4-vue3-0中的响应式原理" class="sidebar-link">4.Vue3.0中的响应式原理</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_5-reactive对比ref" class="sidebar-link">5.reactive对比ref</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_6-setup的两个注意点" class="sidebar-link">6.setup的两个注意点</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_7-计算属性与监视" class="sidebar-link">7.计算属性与监视</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_8-生命周期" class="sidebar-link">8.生命周期</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_9-自定义hook函数" class="sidebar-link">9.自定义hook函数</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_10-toref-torefs" class="sidebar-link">10.toRef/toRefs</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#三、其它-composition-api" class="sidebar-link">三、其它 Composition API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_1-shallowreactive-与-shallowref" class="sidebar-link">1.shallowReactive 与 shallowRef</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_2-readonly-与-shallowreadonly" class="sidebar-link">2.readonly 与 shallowReadonly</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_3-toraw-与-markraw" class="sidebar-link">3.toRaw 与 markRaw</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_4-customref" class="sidebar-link">4.customRef</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_5-provide-与-inject" class="sidebar-link">5. provide 与 inject</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_6-响应式数据的判断" class="sidebar-link">6.响应式数据的判断</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#四、composition-api-的优势" class="sidebar-link">四、Composition API 的优势</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_1-options-api-存在的问题" class="sidebar-link">1.Options API 存在的问题</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_2-composition-api-的优势" class="sidebar-link">2.Composition API 的优势</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#五、新的组件" class="sidebar-link">五、新的组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_1-fragment" class="sidebar-link">1.Fragment</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_2-teleport" class="sidebar-link">2.Teleport</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_3-suspense" class="sidebar-link">3.Suspense</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#六、其他" class="sidebar-link">六、其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_1-全局api的转移" class="sidebar-link">1.全局API的转移</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#_2-其他改变" class="sidebar-link">2.其他改变</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#vue3-setup语法糖" class="sidebar-link">vue3 setup语法糖</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#基础用法" class="sidebar-link">基础用法</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#data和methods" class="sidebar-link">data和methods</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#计算属性" class="sidebar-link">计算属性</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#watch-watcheffect" class="sidebar-link">watch/watchEffect</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#声明props和emits" class="sidebar-link">声明props和emits</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#父组件获取子组件的数据" class="sidebar-link">父组件获取子组件的数据</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#动态css" class="sidebar-link">动态css</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#pinia" class="sidebar-link">Pinia</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#与vuex的比较" class="sidebar-link">与vuex的比较</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#定义一个store" class="sidebar-link">定义一个Store</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#改变状态" class="sidebar-link">改变状态</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/vue/Vue3.html#面试题" class="sidebar-link">面试题</a></li></ul></li><li><a href="/notes/vue/Vue-Router.html" class="sidebar-link">vue-router</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/notes/typescript/ts.html" class="sidebar-link">typescript</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具类</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="从vue2中迁移"><a href="#从vue2中迁移" class="header-anchor">#</a> 从vue2中迁移</h2> <h3 id="v-for中的ref数组"><a href="#v-for中的ref数组" class="header-anchor">#</a> v-for中的Ref数组</h3> <ul><li>在 <strong>vue 2</strong> 中，如果给 v-for 绑定一个 ref ，通过这个 ref 可以获取到全部 v-for 的节点。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;p v-for=&quot;item in renderData&quot; :key=&quot;item.name&quot; ref=&quot;nodes&quot;&gt;{{item.name}}&lt;/p&gt;
// this.$refs.nodes拿到的结果是一个数组，包含所有的p元素，获取某个节点时可以通过index或者过滤方式
</code></pre></div><ul><li>在 <strong>vue 3</strong> 中，对 v-for 的一体化（数组化）处理已经取消，变为函数处理 ref 。如果像vue2一样绑定，只能获取最后一个节点。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// html
&lt;p v-for=&quot;item in renderData&quot; :key=&quot;item.name&quot; :ref=&quot;handleNodes&quot;&gt;{{item.name}}&lt;/p&gt;

// js
handleNodes(el) {
	this.nodesRef.push(el)
}
</code></pre></div><blockquote><p>注意：</p> <ul><li><code>nodesRef</code> 不必是数组：它也可以是一个对象，其 ref 会通过迭代的 key 被设置。</li> <li>如果需要，<code>nodesRef</code> 也可以是响应式的且可以被监听</li></ul></blockquote> <h3 id="异步组件"><a href="#异步组件" class="header-anchor">#</a> 异步组件</h3> <ol><li><p>异步组件的定义需要通过将其包裹在新的 <code>defineAsyncComponent</code> 助手方法中来显式地定义</p> <p><code>vue2: const asyncModal = () =&gt; import('./Modal.vue')</code></p> <p><code>vue3: const asyncModal = defineAsyncComponent(() =&gt; import('./Modal.vue'))</code></p></li> <li><p><strong>带选项的异步组件中</strong><code>component</code> 选项重命名为 <code>loader</code></p> <div class="language- extra-class"><pre class="language-text"><code>const asyncModalWithOptions = defineAsyncComponent({
  // vue2中用的是component，vue3中改为了loader
  loader: () =&gt; import('./Modal.vue'),
  delay: 200,
  timeout: 3000,
  errorComponent: ErrorComponent,
  loadingComponent: LoadingComponent
})
</code></pre></div></li> <li><p>Loader 函数本身不再接收 <code>resolve</code> 和 <code>reject</code> 参数，且必须返回一个 Promise</p> <div class="language- extra-class"><pre class="language-text"><code>// 2.x 版本
const oldAsyncComponent = (resolve, reject) =&gt; {
  /* ... */
}

// 3.x 版本
const asyncComponent = defineAsyncComponent(
  () =&gt;
    new Promise((resolve, reject) =&gt; {
      /* ... */
    })
)
</code></pre></div></li></ol> <h3 id="attrs"><a href="#attrs" class="header-anchor">#</a> $attrs</h3> <p><strong>vue2</strong>中，$attrs 不包含 class  和  style</p> <p>导致的问题</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;my-component id=&quot;my-id&quot; class=&quot;my-class&quot;&gt;&lt;/my-component&gt;
// my-component
&lt;template&gt;
  &lt;label&gt;
    &lt;input type=&quot;text&quot; v-bind=&quot;$attrs&quot; /&gt;
  &lt;/label&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  inheritAttrs: false
}
&lt;/script&gt;

// 生成的html代码
// 由于$attrs不包含class，仍然会应用到组件的根元素
&lt;label class=&quot;my-class&quot;&gt;
  // $attrs 中的 attribute 不再自动添加到根元素中，而是由开发者决定在哪添加
  &lt;input type=&quot;text&quot; id=&quot;my-id&quot; /&gt;
&lt;/label&gt;
</code></pre></div><p><strong>vue3</strong>中，$attrs 包含所有的 attribute，也包括事件 <a href="#emit%E9%80%89%E9%A1%B9">emit选项</a></p> <p>上面的实例就会生成以下HTML</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;label&gt;
  &lt;input type=&quot;text&quot; id=&quot;my-id&quot; class=&quot;my-class&quot; /&gt;
&lt;/label&gt;
</code></pre></div><h3 id="children"><a href="#children" class="header-anchor">#</a> $children</h3> <p>在 vue3 中，<code>$children</code> property 已移除，不再支持。如果你需要访问子组件实例，我们建议使用 $refs</p> <h3 id="自定义元素"><a href="#自定义元素" class="header-anchor">#</a> 自定义元素</h3> <p>如果我们想在 Vue 外部定义添加自定义元素 (例如使用 Web 组件 API)，我们需要“指示”Vue 将其视为自定义元素。</p> <p><strong>vue2</strong></p> <p><code>Vue.config.ignoredElements = ['plastic-button']</code></p> <p><strong>vue3</strong></p> <ul><li><p>webpack配置：通过 <code>vue-loader</code> 的 <code>compilerOptions</code> 选项传递</p> <div class="language- extra-class"><pre class="language-text"><code>rules: [
  {
    test: /\.vue$/,
    use: 'vue-loader',
    options: {
      compilerOptions: {
        isCustomElement: tag =&gt; tag === 'plastic-button'
      }
    }
  }
  // ...
]
</code></pre></div></li> <li><p>动态模版编译：通过 <code>app.config.isCustomElement</code> 传递</p> <div class="language- extra-class"><pre class="language-text"><code>const app = Vue.createApp({})
app.config.isCustomElement = tag =&gt; tag === 'plastic-button'
</code></pre></div></li></ul> <h3 id="is动态组件"><a href="#is动态组件" class="header-anchor">#</a> is动态组件</h3> <p>在 3.0 中，我们仅将 Vue 对 <code>is</code> 属性的特殊处理限制到 <code>&lt;component&gt;</code> tag。</p> <ul><li><p>在保留的 <code>&lt;component&gt;</code> tag 上使用时，它的行为将与 2.x 中完全相同；</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;component is=&quot;bar&quot;&gt;&lt;/component&gt;
</code></pre></div><ul><li>2.x 行为：渲染 <code>bar</code> 组件。</li> <li>3.x 行为：渲染 <code>bar</code> 组件。</li></ul></li> <li><p>在<strong>普通组件</strong>上使用时，它的行为将类似于普通 prop</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;foo is=&quot;bar&quot; /&gt;
</code></pre></div><ul><li>2.x 行为：渲染 <code>bar</code> 组件。</li> <li>3.x 行为：通过 <code>is</code> prop 渲染 <code>foo</code> 组件。</li></ul></li> <li><p>在<strong>普通元素</strong>上使用时，它将<code>is</code> 作为原生 attribute 渲染。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;button is=&quot;plastic-button&quot;&gt;点击我！&lt;/button&gt;
</code></pre></div><ul><li>2.x 行为：渲染 <code>plastic-button</code> 组件。</li> <li>3.x 行为：通过回调渲染原生的 button。</li></ul></li> <li><p>3.x中实现2.x is 的用法，可以用vue: 前缀</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;table&gt;
  &lt;tr is=&quot;vue:blog-post-row&quot;&gt;&lt;/tr&gt;
&lt;/table&gt;
</code></pre></div></li></ul> <h3 id="data选项"><a href="#data选项" class="header-anchor">#</a> data选项</h3> <ol><li>在 3.x，<code>data</code> 选项已标准化为只接受返回 <code>object</code> 的 <code>function</code>。</li> <li>当合并来自 mixin 或 extend 的多个 <code>data</code> 返回值时，现在是浅层次合并的而不是深层次合并的(只合并根级属性)。</li></ol> <h3 id="emit选项"><a href="#emit选项" class="header-anchor">#</a> emit选项</h3> <p>Vue 3 目前提供一个 <code>emits</code> 选项，和现有的 <code>props</code> 选项类似。这个选项可以用来定义组件可以向其父组件触发的事件</p> <p><strong>强烈建议使用 <code>emits</code> 记录每个组件所触发的所有事件。任何未声明 <code>emits</code> 的事件监听器都会被算入组件的 <code>$attrs</code> 并绑定在组件的根节点上。</strong></p> <p>以下代码的点击（同一个）事件将会被触发<strong>两次</strong></p> <div class="language- extra-class"><pre class="language-text"><code>// 父组件
&lt;my-button v-on:click=&quot;handleClick&quot;&gt;&lt;/my-button&gt;

// 子组件
&lt;template&gt;
  &lt;button v-on:click=&quot;$emit('click', $event)&quot;&gt;OK&lt;/button&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  emits: [] // 不声明事件
}
&lt;/script&gt;
</code></pre></div><h3 id="移除过滤器"><a href="#移除过滤器" class="header-anchor">#</a> 移除过滤器</h3> <p>从 Vue 3.0 开始，过滤器已删除，不再支持，替换方案如下：</p> <ol><li><p>局部过滤器：用方法调用或计算属性替换</p></li> <li><p>全局过滤器：可以通过全局属性在所有组件中使用它</p> <div class="language- extra-class"><pre class="language-text"><code>// 全局属性设置
app.config.globalProperties.$filters = {
  currencyUSD(value) {
    return '$' + value
  }
}

// 使用
&lt;p&gt;{{ $filters.currencyUSD(accountBalance) }}&lt;/p&gt;
</code></pre></div></li></ol> <h3 id="支持多个根节点"><a href="#支持多个根节点" class="header-anchor">#</a> 支持多个根节点</h3> <p>vue2.x单文本组件中，在<code>template</code>内只能有一个根节点</p> <p>vue3.x支持多节点</p> <h3 id="监听组件生命周期"><a href="#监听组件生命周期" class="header-anchor">#</a> 监听组件生命周期</h3> <p><strong>vue2</strong>中用的是@hook</p> <p><code>&lt;child-component @hook:updated=&quot;onUpdated&quot;&gt;</code></p> <p><strong>vue3</strong>中用的是vue:前缀或者在驼峰命名法的情况下附带前缀 vue</p> <p><code>&lt;child-component @vue:updated=&quot;onUpdated&quot;&gt;</code></p> <p><code>&lt;child-component @vueUpdated=&quot;onUpdated&quot;&gt;</code></p> <h3 id="指令"><a href="#指令" class="header-anchor">#</a> 指令</h3> <h4 id="v-bind-合并行为"><a href="#v-bind-合并行为" class="header-anchor">#</a> v-bind 合并行为</h4> <div class="language- extra-class"><pre class="language-text"><code>&lt;div id=&quot;red&quot; v-bind=&quot;{ id: 'blue' }&quot;&gt;&lt;/div&gt;
// vue2: 单独的总会覆盖v-bind的对象
&lt;div id=&quot;red&quot;&gt;&lt;/div&gt;
// vue3: 谁后定义谁生效
&lt;div id=&quot;blue&quot;&gt;&lt;/div&gt;
</code></pre></div><h4 id="v-if-与-v-for的优先级对比"><a href="#v-if-与-v-for的优先级对比" class="header-anchor">#</a> v-if 与 v-for的优先级对比</h4> <p>2.x 版本中在一个元素上同时使用 <code>v-if</code> 和 <code>v-for</code> 时，<code>v-for</code> 会优先作用。</p> <p>3.x 版本中 <code>v-if</code> 总是优先于 <code>v-for</code> 生效，也就是说可以在v-for里面写v-if</p> <p><strong>以后如果有v-if + v-for 的面试题，可以把vue3的改动也加上</strong></p> <h4 id="v-model"><a href="#v-model" class="header-anchor">#</a> v-model</h4> <p>在 3.x 中，<strong>自定义组件</strong>上的 <code>v-model</code> 相当于传递了 <code>modelValue</code> prop 并接收抛出的 <code>update:modelValue</code> 事件</p> <ul><li>修改model名称，可以通过<code>v-model:title=&quot;pageTitle&quot;</code>，与vue2中的<code>v-bind:title.sync=&quot;pageTitle&quot;</code></li> <li>一个组件可以使用多个v-model</li></ul> <h4 id="自定义指令"><a href="#自定义指令" class="header-anchor">#</a> 自定义指令</h4> <ol><li><p>指令的钩子函数已经被重命名，以更好地与组件的生命周期保持一致。</p> <ul><li>created - 新的！在元素的 attribute 或事件侦听器应用之前调用。</li> <li>bind → <strong>beforeMount</strong></li> <li>inserted → <strong>mounted</strong></li> <li><strong>beforeUpdate</strong>：新的！这是在元素本身更新之前调用的，很像组件生命周期钩子。</li> <li>update → 移除！与<code>updated</code>钩子太多的相似之处要更新，所以这是多余的，请改用 <code>updated</code>。</li> <li>componentUpdated → <strong>updated</strong></li> <li><strong>beforeUnmount</strong>：新的！与组件生命周期钩子类似，它将在卸载元素之前调用。</li> <li>unbind -&gt; <strong>unmounted</strong></li></ul></li> <li><p>访问组件实例</p> <p>在vue2中通过vnode访问</p> <p>在vue3中通过<code>binding.instance</code></p></li></ol> <h4 id="移除了-v-on-的-native-修饰符"><a href="#移除了-v-on-的-native-修饰符" class="header-anchor">#</a> 移除了 v-on 的 native 修饰符</h4> <h3 id="按键修饰符"><a href="#按键修饰符" class="header-anchor">#</a> 按键修饰符</h3> <ul><li><p>不再支持使用数字 (即键码) 作为 <code>v-on</code> 修饰符</p> <p><code>&lt;input v-on:keyup.13=&quot;submit&quot; /&gt;</code></p></li> <li><p>不再支持 <code>config.keyCodes</code></p> <div class="language- extra-class"><pre class="language-text"><code>Vue.config.keyCodes = {
  f1: 112
}
&lt;!-- 键码版本 --&gt;
&lt;input v-on:keyup.112=&quot;showHelpText&quot; /&gt;
&lt;!-- 自定义别名版本 --&gt;
&lt;input v-on:keyup.f1=&quot;showHelpText&quot; /&gt;
</code></pre></div></li></ul> <h3 id="移除-listener"><a href="#移除-listener" class="header-anchor">#</a> 移除$listener</h3> <p>现在事件监听器是 <code>$attrs</code> 的一部分</p> <h3 id="移除内联模版"><a href="#移除内联模版" class="header-anchor">#</a> 移除内联模版</h3> <p>vue2内联模版</p> <div class="language- extra-class"><pre class="language-text"><code>// 定义子组件
var ChildComponent = Vue.component({
	template: '&lt;div&gt;&lt;/div&gt;' 
})
// 父组件中使用：
var FatherComponent = Vue.component({
	template: `&lt;div&gt;
                  &lt;child-component   inline-template&gt;
                    &lt;p&gt;这是inline-template&lt;/p&gt;
                 &lt;/child-component&gt;
              &lt;/div&gt;`
})

// 最终结果: p标签的内容不需要子组件中放置插槽就可以渲染出来。
&lt;div&gt;
    &lt;p&gt;这是inline-template&lt;/p&gt;
&lt;/div&gt;
</code></pre></div><h3 id="propsdata"><a href="#propsdata" class="header-anchor">#</a> propsData</h3> <p><code>propsData</code> 选项之前用于在创建 Vue 实例的过程中传入 prop，现在它被移除了。如果想为 Vue 3 应用的根组件传入 prop，请使用 <a href="#createApp">createApp</a> 的第二个参数。</p> <h3 id="插槽统一"><a href="#插槽统一" class="header-anchor">#</a> 插槽统一</h3> <p>定义插槽名称</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 2.x 语法</span>
<span class="token function">h</span><span class="token punctuation">(</span>LayoutComponent<span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">slot</span><span class="token operator">:</span> <span class="token string">'header'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">slot</span><span class="token operator">:</span> <span class="token string">'content'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 3.x Syntax</span>
<span class="token function">h</span><span class="token punctuation">(</span>LayoutComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">header</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">content</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>当你需要以编程方式引用作用域插槽时，它们现在被统一到 <code>$slots</code> 选项中了。</p> <div class="language- extra-class"><pre class="language-text"><code>// 2.x 语法
this.$scopedSlots.header

// 3.x 语法
this.$slots.header()
</code></pre></div><h3 id="过渡的class名更改"><a href="#过渡的class名更改" class="header-anchor">#</a> 过渡的class名更改</h3> <p>过渡类名 <code>v-enter</code> 修改为 <code>v-enter-from</code>、过渡类名 <code>v-leave</code> 修改为 <code>v-leave-from</code>。</p> <h3 id="api改动"><a href="#api改动" class="header-anchor">#</a> API改动</h3> <h4 id="全局api"><a href="#全局api" class="header-anchor">#</a> 全局API</h4> <h5 id="createapp"><a href="#createapp" class="header-anchor">#</a> createApp</h5> <p>vue3引入了<code>createApp</code>，Vue上的所有全局API在创建的app实例上同样存在</p> <div class="language- extra-class"><pre class="language-text"><code>import { createApp } from 'vue'
const app = createApp({})
</code></pre></div><h6 id="config-productiontip移除"><a href="#config-productiontip移除" class="header-anchor">#</a> <code>config.productionTip</code>移除</h6> <h6 id="config-ignoredelements-替换为-app-config-iscustomelement"><a href="#config-ignoredelements-替换为-app-config-iscustomelement" class="header-anchor">#</a> <code>config.ignoredElements</code> 替换为 <code>app.config.isCustomElement</code></h6> <p>​	<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0">自定义元素</a></p> <h6 id="vue-prototype-替换为-app-config-globalproperties"><a href="#vue-prototype-替换为-app-config-globalproperties" class="header-anchor">#</a> <code>Vue.prototype</code> 替换为 <code>app.config.globalProperties</code></h6> <div class="language- extra-class"><pre class="language-text"><code>Vue.prototype.$http
// 使用
this.$http
</code></pre></div><h6 id="移除vue-extend"><a href="#移除vue-extend" class="header-anchor">#</a> 移除<code>Vue.extend</code></h6> <blockquote><p>在 Vue 3 中，我们强烈建议使用 <a href="https://v3.cn.vuejs.org/api/composition-api.html" target="_blank" rel="noopener noreferrer">组合式 API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来替代继承与 mixin。如果因为某种原因仍然需要使用组件继承，你可以使用 <a href="https://v3.cn.vuejs.org/api/options-composition.html#extends" target="_blank" rel="noopener noreferrer"><code>extends</code> 选项<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来代替 <code>Vue.extend</code>。</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// vue2
// 用Vue.extend
const Profile = Vue.extend({
  template: '&lt;p&gt;{{firstName}} {{lastName}} aka {{alias}}&lt;/p&gt;',
  data() {
    return {
      firstName: 'Walter',
      lastName: 'White',
      alias: 'Heisenberg'
    }
  }
})
new Profile().$mount('#mount-point')

// vue 3
const Profile = {
  template: '&lt;p&gt;{{firstName}} {{lastName}} aka {{alias}}&lt;/p&gt;',
  data() {
    return {
      firstName: 'Walter',
      lastName: 'White',
      alias: 'Heisenberg'
    }
  }
}
// 用createApp
Vue.createApp(Profile).mount('#mount-point')
</code></pre></div><h6 id="引入插件方法修改"><a href="#引入插件方法修改" class="header-anchor">#</a> 引入插件方法修改</h6> <div class="language- extra-class"><pre class="language-text"><code>const app = createApp(MyApp)
app.use(VueRouter)
</code></pre></div><h5 id="挂载app实例"><a href="#挂载app实例" class="header-anchor">#</a> 挂载APP实例</h5> <div class="language- extra-class"><pre class="language-text"><code>import { createApp } from 'vue'
import MyApp from './MyApp.vue'
// vue2
new Vue({
	render: (h) =&gt; h(App),
}).$mount(&quot;#app&quot;);

// vue3
const app = createApp(MyApp)
app.mount('#app')
</code></pre></div><h5 id="provide-inject"><a href="#provide-inject" class="header-anchor">#</a> Provide / Inject</h5> <div class="language- extra-class"><pre class="language-text"><code>// 在入口
app.provide('guide', 'Vue 3 Guide')

// 在子组件
export default {
  inject: {
    book: {
      from: 'guide'
    }
  },
  template: `&lt;div&gt;{{ book }}&lt;/div&gt;`
}
</code></pre></div><h5 id="在应用之间共享配置"><a href="#在应用之间共享配置" class="header-anchor">#</a> 在应用之间共享配置</h5> <div class="language- extra-class"><pre class="language-text"><code>import { createApp } from 'vue'
import Foo from './Foo.vue'
import Bar from './Bar.vue'
// 创建工厂函数
const createMyApp = options =&gt; {
  const app = createApp(options)
  app.directive('focus' /* ... */)
  return app
}
// Foo 和 Bar 实例及其后代中都可以使用 focus 指令。
createMyApp(Foo).mount('#foo')
createMyApp(Bar).mount('#bar')
</code></pre></div><h5 id="treeshaking"><a href="#treeshaking" class="header-anchor">#</a> Treeshaking</h5> <p>vue2中，全局 API 如 <code>Vue.nextTick()</code> 是不支持 tree-shake 的，不管它们实际是否被使用，都会被包含在最终的打包产物中。</p> <ul><li>Vue.nextTick</li> <li>Vue.observable</li> <li>Vue.version</li> <li>Vue.compile</li> <li>Vue.set</li> <li>Vue.delete</li></ul> <p><code>import { nextTick } from 'vue'</code></p> <p>在 Vue 3 中，全局和内部 API 都经过了重构，并考虑到了 tree-shaking 的支持。因此，全局 API 现在只能作为 ES 模块构建的命名导出进行访问（使用时要引入，否则会<strong>报错</strong>）。</p> <h4 id="挂载api变化"><a href="#挂载api变化" class="header-anchor">#</a> 挂载API变化</h4> <p>在 Vue 2.x 中，当挂载一个具有 <code>template</code> 的应用时，被渲染的内容会<strong>替换</strong>我们要挂载的目标元素。</p> <p>在 Vue 3.x 中，被渲染的应用会作为<strong>子元素</strong>插入。</p> <h4 id="事件api"><a href="#事件api" class="header-anchor">#</a> 事件API</h4> <p><code>$on</code>，<code>$off</code> 和 <code>$once</code> 实例方法已被移除，组件实例不再实现事件触发接口</p> <p><strong>就是EventBus 不存在了，不能用这种方法进行传值了</strong></p> <p>Event bus 模式可以被替换为实现了事件触发器接口的外部库，例如 <a href="https://github.com/developit/mitt" target="_blank" rel="noopener noreferrer">mitt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或 <a href="https://github.com/scottcorgan/tiny-emitter" target="_blank" rel="noopener noreferrer">tiny-emitter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="渲染函数api"><a href="#渲染函数api" class="header-anchor">#</a> 渲染函数API</h4> <h5 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h5> <p>在vue2中，<code>render</code> 函数会自动接收 <code>h</code> 函数 (它是 <code>createElement</code> 的惯用别名) 作为参数</p> <p>在 vue3 中，<code>h</code> 函数现在是全局导入的，而不是作为参数自动传递。</p> <p>​	<code>import { h } from 'vue'</code></p> <h5 id="注册组件"><a href="#注册组件" class="header-anchor">#</a> 注册组件</h5> <div class="language- extra-class"><pre class="language-text"><code>Vue.component('button-counter', {
  data() {
    return {
      count: 0
    }
  }
  template: `
    &lt;button @click=&quot;count++&quot;&gt;
      Clicked {{ count }} times.
    &lt;/button&gt;
  `
})
</code></pre></div><p>在 vue2 中，注册一个组件后，把组件名作为字符串传给渲染函数的第一个参数，渲染函数可以正常的工作</p> <div class="language- extra-class"><pre class="language-text"><code>export default {
  render(h) {
    return h('button-counter')
  }
}
</code></pre></div><p>在 vue3中，不能再用字符串 ID 隐式查找已注册组件，需要使用一个导入的 <code>resolveComponent</code> 方法</p> <div class="language- extra-class"><pre class="language-text"><code>import { h, resolveComponent } from 'vue'

export default {
  setup() {
    const ButtonCounter = resolveComponent('button-counter')
    return () =&gt; h(ButtonCounter)
  }
}
</code></pre></div><h2 id="vue3快速上手"><a href="#vue3快速上手" class="header-anchor">#</a> Vue3快速上手</h2> <img src="https://user-images.githubusercontent.com/499550/93624428-53932780-f9ae-11ea-8d16-af949e16a09f.png" style="width:200px;"> <h3 id="_1-vue3简介"><a href="#_1-vue3简介" class="header-anchor">#</a> 1.Vue3简介</h3> <ul><li>2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）</li> <li>耗时2年多、<a href="https://github.com/vuejs/vue-next/graphs/commit-activity" target="_blank" rel="noopener noreferrer">2600+次提交<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/vuejs/rfcs/tree/master/active-rfcs" target="_blank" rel="noopener noreferrer">30+个RFC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/vuejs/vue-next/pulls?q=is%3Apr+is%3Amerged+-author%3Aapp%2Fdependabot-preview+" target="_blank" rel="noopener noreferrer">600+次PR<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/vuejs/vue-next/graphs/contributors" target="_blank" rel="noopener noreferrer">99位贡献者<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>github上的tags地址：https://github.com/vuejs/vue-next/releases/tag/v3.0.0</li></ul> <h3 id="_2-vue3带来了什么"><a href="#_2-vue3带来了什么" class="header-anchor">#</a> 2.Vue3带来了什么</h3> <h4 id="_1-性能的提升"><a href="#_1-性能的提升" class="header-anchor">#</a> 1.性能的提升</h4> <ul><li><p>打包大小减少41%</p></li> <li><p>初次渲染快55%, 更新渲染快133%</p></li> <li><p>内存减少54%</p> <p>......</p></li></ul> <h4 id="_2-源码的升级"><a href="#_2-源码的升级" class="header-anchor">#</a> 2.源码的升级</h4> <ul><li><p>使用Proxy代替defineProperty实现响应式</p></li> <li><p>重写虚拟DOM的实现和Tree-Shaking</p> <p>......</p></li></ul> <h4 id="_3-拥抱typescript"><a href="#_3-拥抱typescript" class="header-anchor">#</a> 3.拥抱TypeScript</h4> <ul><li>Vue3可以更好的支持TypeScript</li></ul> <h4 id="_4-新的特性"><a href="#_4-新的特性" class="header-anchor">#</a> 4.新的特性</h4> <ol><li><p>Composition API（组合API）</p> <ul><li>setup配置</li> <li>ref与reactive</li> <li>watch与watchEffect</li> <li>provide与inject</li> <li>......</li></ul></li> <li><p>新的内置组件</p> <ul><li>Fragment</li> <li>Teleport</li> <li>Suspense</li></ul></li> <li><p>其他改变</p> <ul><li>新的生命周期钩子</li> <li>data 选项应始终被声明为一个函数</li> <li>移除keyCode支持作为 v-on 的修饰符</li> <li>......</li></ul></li></ol> <h2 id="一、创建vue3-0工程"><a href="#一、创建vue3-0工程" class="header-anchor">#</a> 一、创建Vue3.0工程</h2> <h3 id="_1-使用-vue-cli-创建"><a href="#_1-使用-vue-cli-创建" class="header-anchor">#</a> 1.使用 vue-cli 创建</h3> <p>官方文档：https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span>
vue --version
<span class="token comment">## 安装或者升级你的@vue/cli</span>
<span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli
<span class="token comment">## 创建</span>
vue create vue_test
<span class="token comment">## 启动</span>
<span class="token builtin class-name">cd</span> vue_test
<span class="token function">npm</span> run serve
</code></pre></div><h3 id="_2-使用-vite-创建"><a href="#_2-使用-vite-创建" class="header-anchor">#</a> 2.使用 vite 创建</h3> <p>官方文档：https://v3.cn.vuejs.org/guide/installation.html#vite</p> <p>vite官网：https://vitejs.cn</p> <ul><li>什么是vite？—— 新一代前端构建工具。</li> <li>优势如下：
<ul><li>开发环境中，无需打包操作，可快速的冷启动。</li> <li>轻量快速的热重载（HMR）。</li> <li>真正的按需编译，不再等待整个应用编译完成。</li></ul></li> <li>传统构建 与 vite构建对比图</li></ul> <p><img src="https://cn.vitejs.dev/assets/bundler.37740380.png" style="width:500px;height:280px;float:left;"><img src="https://cn.vitejs.dev/assets/esm.3070012d.png" style="width:480px;height:280px;"></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">## 创建工程</span>
<span class="token function">npm</span> init vite-app <span class="token operator">&lt;</span>project-name<span class="token operator">&gt;</span>
<span class="token comment">## 进入工程目录</span>
<span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>project-name<span class="token operator">&gt;</span>
<span class="token comment">## 安装依赖</span>
<span class="token function">npm</span> <span class="token function">install</span>
<span class="token comment">## 运行</span>
<span class="token function">npm</span> run dev
</code></pre></div><h2 id="二、常用-composition-api"><a href="#二、常用-composition-api" class="header-anchor">#</a> 二、常用 Composition API</h2> <p>官方文档: https://v3.cn.vuejs.org/guide/composition-api-introduction.html</p> <h3 id="_1-拉开序幕的setup"><a href="#_1-拉开序幕的setup" class="header-anchor">#</a> 1.拉开序幕的setup</h3> <ol><li>理解：Vue3.0中一个新的配置项，值为一个函数。</li> <li>setup是所有<strong style="color:#DD5145;">Composition API（组合API）</strong><i style="color:gray;font-weight:bold;">“ 表演的舞台 ”</i>。</li> <li>组件中所用到的：数据、方法等等，均要配置在setup中。</li> <li>setup函数的两种返回值：
<ol><li>若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）</li> <li><span style="color:#aad;">若返回一个渲染函数：则可以自定义渲染内容。（了解）</span></li></ol></li> <li>注意点：
<ol><li>尽量不要与Vue2.x配置混用
<ul><li>Vue2.x配置（data、methos、computed...）中<strong style="color:#DD5145;">可以访问到</strong>setup中的属性、方法。</li> <li>但在setup中<strong style="color:#DD5145;">不能访问到</strong>Vue2.x配置（data、methos、computed...）。</li> <li>如果有重名, setup优先。</li></ul></li> <li>setup不能是一个async函数，因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性。（后期也可以返回一个Promise实例，但需要Suspense和异步组件的配合）</li></ol></li></ol> <h3 id="_2-ref函数"><a href="#_2-ref函数" class="header-anchor">#</a> 2.ref函数</h3> <ul><li>作用: 定义一个响应式的数据</li> <li>语法: <code>const xxx = ref(initValue)</code> <ul><li>创建一个包含响应式数据的<strong style="color:#DD5145;">引用对象（reference对象，简称ref对象）</strong>。</li> <li>JS中操作数据： <code>xxx.value</code></li> <li>模板中读取数据: 不需要.value，直接：<code>&lt;div&gt;&lt;/div&gt;</code></li></ul></li> <li>备注：
<ul><li>接收的数据可以是：基本类型、也可以是对象类型。</li> <li>基本类型的数据：响应式依然是靠<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>完成的。</li> <li>对象类型的数据：内部 <i style="color:gray;font-weight:bold;">“ 求助 ”</i> 了Vue3.0中的一个新函数—— <code>reactive</code>函数。</li></ul></li></ul> <h3 id="_3-reactive函数"><a href="#_3-reactive函数" class="header-anchor">#</a> 3.reactive函数</h3> <ul><li>作用: 定义一个<strong style="color:#DD5145;">对象类型</strong>的响应式数据（基本类型不要用它，要用<code>ref</code>函数）</li> <li>语法：<code>const 代理对象= reactive(源对象)</code>接收一个对象（或数组），返回一个<strong style="color:#DD5145;">代理对象（Proxy的实例对象，简称proxy对象）</strong></li> <li>reactive定义的响应式数据是“深层次的”。</li> <li>内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据进行操作。</li></ul> <h3 id="_4-vue3-0中的响应式原理"><a href="#_4-vue3-0中的响应式原理" class="header-anchor">#</a> 4.Vue3.0中的响应式原理</h3> <h4 id="vue2-x的响应式"><a href="#vue2-x的响应式" class="header-anchor">#</a> vue2.x的响应式</h4> <ul><li><p>实现原理：</p> <ul><li><p>对象类型：通过<code>Object.defineProperty()</code>对属性的读取、修改进行拦截（数据劫持）。</p></li> <li><p>数组类型：通过重写更新数组的一系列方法来实现拦截。（对数组的变更方法进行了包裹）。</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token function">set</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li> <li><p>存在问题：</p> <ul><li>新增属性、删除属性, 界面不会更新。</li> <li>直接通过下标修改数组, 界面不会自动更新。</li></ul></li></ul> <h4 id="vue3-0的响应式"><a href="#vue3-0的响应式" class="header-anchor">#</a> Vue3.0的响应式</h4> <ul><li><p>实现原理:</p> <ul><li><p>通过Proxy（代理）:  拦截对象中任意属性的变化, 包括：属性值的读写、属性的添加、属性的删除等。</p></li> <li><p>通过Reflect（反射）:  对源对象的属性进行操作。</p></li> <li><p>MDN文档中描述的Proxy与Reflect：</p> <ul><li><p>Proxy：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</p></li> <li><p>Reflect：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">// 拦截读取属性值</span>
    <span class="token function">get</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 拦截设置属性值或添加新属性</span>
    <span class="token function">set</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 拦截删除属性</span>
    <span class="token function">deleteProperty</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

proxy<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'tom'</span>   
</code></pre></div></li></ul></li></ul></li> <li><p>关于Proxy为什么要配合Reflect一起用</p> <p>https://blog.csdn.net/qq_45828551/article/details/126251545</p> <p><strong>Proxy 中接受的 receiver 形参，表示代理对象本身 或者 继承了代理对象的对象。</strong></p> <p><strong>Reflect 中传入的 receiver实参，表示修改执行原始操作时的 this 指向。</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 等同于没有传入receiver的Reflect: return Reflect.get(target, key) </span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">let</span> child <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;小Tom&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 设置 child 继承 代理对象 proxy</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 因为child没有value属性，但是它继承的 proxy 对象中存在 value 属性的访问方法</span>
<span class="token comment">// 所以触发proxy上的get value()，由于访问的是proxy上的value属性，所以this指向了proxy</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Reflect传入receiver参数时，把属性访问中的this指向了receiver对象</span>
<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="_5-reactive对比ref"><a href="#_5-reactive对比ref" class="header-anchor">#</a> 5.reactive对比ref</h3> <ul><li>从定义数据角度对比：
<ul><li>ref用来定义：<strong style="color:#DD5145;">基本类型数据</strong>。</li> <li>reactive用来定义：<strong style="color:#DD5145;">对象（或数组）类型数据</strong>。</li> <li>备注：ref也可以用来定义<strong style="color:#DD5145;">对象（或数组）类型数据</strong>, 它内部会自动通过<code>reactive</code>转为<strong style="color:#DD5145;">代理对象</strong>。</li></ul></li> <li>从原理角度对比：
<ul><li>ref通过<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>来实现响应式（数据劫持）。</li> <li>reactive通过使用<strong style="color:#DD5145;">Proxy</strong>来实现响应式（数据劫持）, 并通过<strong style="color:#DD5145;">Reflect</strong>操作<strong style="color:orange;">源对象</strong>内部的数据。</li></ul></li> <li>从使用角度对比：
<ul><li>ref定义的数据：操作数据<strong style="color:#DD5145;">需要</strong><code>.value</code>，读取数据时模板中直接读取<strong style="color:#DD5145;">不需要</strong><code>.value</code>。</li> <li>reactive定义的数据：操作数据与读取数据：<strong style="color:#DD5145;">均不需要</strong><code>.value</code>。</li></ul></li></ul> <h3 id="_6-setup的两个注意点"><a href="#_6-setup的两个注意点" class="header-anchor">#</a> 6.setup的两个注意点</h3> <ul><li><p>setup执行的时机</p> <ul><li>在beforeCreate之前执行一次，this是undefined。</li></ul></li> <li><p>setup的参数</p> <ul><li><p>props：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性。</p> <div class="language- extra-class"><pre class="language-text"><code>export default {
	props: ['message'],
	setup(props, context) {
		console.log(props.text);
	}
}

// setup语法糖
const props = defineProps(['message']);
console.log(props.text);
</code></pre></div></li> <li><p>context：上下文对象</p> <ul><li><p>attrs: 值为对象，包含：组件外部传递过来，但没有在props配置中声明的属性, 相当于 <code>this.$attrs</code>。</p></li> <li><p>slots: 收到的插槽内容, 相当于 <code>this.$slots</code>。</p></li> <li><p>emit: 分发自定义事件的函数, 相当于 <code>this.$emit</code>。</p> <div class="language- extra-class"><pre class="language-text"><code>// App.vue
&lt;template&gt;
	&lt;Child v-bind=&quot;attrs&quot; @btnClick=&quot;btnClick&quot;&gt;
		&lt;v-slot&gt;default&lt;/v-slot&gt;
        &lt;template #hello&gt;
            hello world
        &lt;/template&gt;
    &lt;/Child&gt;
&lt;/template&gt;
&lt;script setup&gt;
const attrs = {
	id: 'child',
	a: 1,
	b: 2
}
const btnClick = (params) =&gt; {
	console.log(&quot;===btnClick&quot;, params);
}
&lt;/script&gt;

// Child.vue
&lt;template&gt;
	&lt;div id=&quot;test&quot;&gt;
        props: {{ props.count }}
        &lt;br /&gt;
        attrs: {{ attrs.a }}----{{ attrs.b }}
        &lt;br /&gt;
        slot: &lt;slot&gt;&lt;/slot&gt;
        &lt;br /&gt;
        hello slot: &lt;slot name=&quot;hello&quot;&gt;&lt;/slot&gt;
        &lt;button @click=&quot;btnClick&quot;&gt;点我!&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;
&lt;script setup&gt;
import { useAttrs, useSlots } from 'vue';
const attrs = useAttrs();
const slots = useSlots();
const emits = defineEmits(['btnClick']);

const btnClick = () =&gt; {
	emits('btnClick', 'this is btnClick params');
}
&lt;/script&gt;

// 非setup语法糖
&lt;script&gt;
export default {
	emits: ['btnClick'], // 这里定义了ctx里面才会有该方法
	setup(props, ctx) {
		const btnClick = () =&gt; {
			ctx.emit('btnClick', 'this is btnClick params');
		}
		
		return { btnClick }
	}
}
&lt;/script&gt;
</code></pre></div></li></ul></li></ul></li></ul> <h3 id="_7-计算属性与监视"><a href="#_7-计算属性与监视" class="header-anchor">#</a> 7.计算属性与监视</h3> <h4 id="_1-computed函数"><a href="#_1-computed函数" class="header-anchor">#</a> 1.computed函数</h4> <ul><li><p>与Vue2.x中computed配置功能一致</p></li> <li><p>写法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>computed<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
	<span class="token comment">//计算属性——简写</span>
    <span class="token keyword">let</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//计算属性——完整</span>
    <span class="token keyword">let</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> nameArr <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
            person<span class="token punctuation">.</span>firstName <span class="token operator">=</span> nameArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            person<span class="token punctuation">.</span>lastName <span class="token operator">=</span> nameArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h4 id="_2-watch函数"><a href="#_2-watch函数" class="header-anchor">#</a> 2.watch函数</h4> <ul><li><p>与Vue2.x中watch配置功能一致</p></li> <li><p>两个小“坑”：</p> <ul><li>监视reactive定义的响应式数据时：oldValue无法正确获取、强制开启了深度监视（deep配置失效）。</li> <li>监视reactive定义的响应式数据中某个属性时：deep配置有效。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//情况一：监视ref定义的响应式数据</span>
<span class="token function">watch</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sum变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">immediate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//情况二：监视多个ref定义的响应式数据</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>sum<span class="token punctuation">,</span>msg<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sum或msg变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 

<span class="token comment">/* 情况三：监视reactive定义的响应式数据
			若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！
			若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 
*/</span>
<span class="token function">watch</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">immediate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">deep</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//此处的deep配置不再奏效</span>

<span class="token comment">//情况四：监视reactive定义的响应式数据中的某个属性</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>person<span class="token punctuation">.</span>job<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person的job变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">immediate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">deep</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 

<span class="token comment">//情况五：监视reactive定义的响应式数据中的某些属性</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>person<span class="token punctuation">.</span>job<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>person<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person的job变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">immediate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">deep</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//特殊情况</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>person<span class="token punctuation">.</span>job<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person的job变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">deep</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//此处由于监视的是reactive素定义的对象中的某个属性，所以deep配置有效</span>
</code></pre></div></li></ul> <h4 id="_3-watcheffect函数"><a href="#_3-watcheffect函数" class="header-anchor">#</a> 3.watchEffect函数</h4> <ul><li><p>watch的套路是：既要指明监视的属性，也要指明监视的回调。</p></li> <li><p>watchEffect的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。</p></li> <li><p>watchEffect有点像computed：</p> <ul><li>但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</li> <li>而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> x1 <span class="token operator">=</span> sum<span class="token punctuation">.</span>value
    <span class="token keyword">const</span> x2 <span class="token operator">=</span> person<span class="token punctuation">.</span>age
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watchEffect配置的回调执行了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="_8-生命周期"><a href="#_8-生命周期" class="header-anchor">#</a> 8.生命周期</h3> <p><img src="/notes/img/vue3lifecycle.png" alt="vue3生命周期"></p> <ul><li><p>Vue3.0中可以继续使用Vue2.x中的生命周期钩子，但有有两个被更名：</p> <ul><li><code>beforeDestroy</code>改名为 <code>beforeUnmount</code></li> <li><code>destroyed</code>改名为 <code>unmounted</code></li></ul></li> <li><p>Vue3.0也提供了 Composition API 形式的生命周期钩子，与Vue2.x中钩子对应关系如下：</p> <ul><li><code>beforeCreate</code>===&gt;<code>setup()</code></li> <li><code>created</code>=======&gt;<code>setup()</code></li> <li><code>beforeMount</code> ===&gt;<code>onBeforeMount</code></li> <li><code>mounted</code>=======&gt;<code>onMounted</code></li> <li><code>beforeUpdate</code>===&gt;<code>onBeforeUpdate</code></li> <li><code>updated</code> =======&gt;<code>onUpdated</code></li> <li><code>beforeUnmount</code> ==&gt;<code>onBeforeUnmount</code></li> <li><code>unmounted</code> =====&gt;<code>onUnmounted</code></li></ul></li> <li><p>父子组件生命周期触发顺序</p> <ul><li><p>组件加载时</p> <p>父组件onBeforeMount -&gt; 子组件onBeforeMount -&gt; 子组件onMounted -&gt; 父组件onMounted</p></li> <li><p>子组件更新时</p> <p>子组件onBeforeUpdate -&gt; 子组件onUpdated- &gt; 父组件onBeforeUpdate -&gt; 父组件onUpdated</p></li> <li><p>父组件更新时，如果不涉及到传给子组件的值变更，子组件不会触发钩子函数，如果有的话</p> <p>父组件onBeforeUpdate -&gt; 子组件onBeforeUpdate -&gt; 子组件onUpdated- &gt; 父组件onUpdated</p></li></ul></li></ul> <h3 id="_9-自定义hook函数"><a href="#_9-自定义hook函数" class="header-anchor">#</a> 9.自定义hook函数</h3> <ul><li>什么是hook？—— 本质是一个函数，把setup函数中使用的Composition API进行了封装。</li> <li>类似于vue2.x中的mixin。</li> <li>自定义hook的优势: 复用代码, 让setup中的逻辑更清楚易懂。</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>// hook.js
import {onBeforeMount, onBeforeUnmount, reactive} from 'vue'
export default function () {
    const point = reactive({
        x:0,
        y:0
    })
    function savePoint (event) {
        point.y = event.pageY
        point.x = event.pageX
        console.log('x,y', point.y, point.x)
    }
    onBeforeMount(() =&gt; {
        // 监听click事件
        window.addEventListener('click',savePoint)
    })
    onBeforeUnmount(() =&gt; {
        window.removeEventListener('click',savePoint)
    })
    return point
};

// com.js
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前求和为：{{ sum }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sum++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{point}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> usePoint <span class="token keyword">from</span> <span class="token string">'./hook.js'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Demo'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//数据</span>
            <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment">// 引用公共hook函数</span>
            <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token function">usePoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                sum<span class="token punctuation">,</span>
                point
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_10-toref-torefs"><a href="#_10-toref-torefs" class="header-anchor">#</a> 10.toRef/toRefs</h3> <ul><li><p>作用：创建一个 ref 对象，其value值指向另一个对象中的某个属性。</p></li> <li><p>语法：<code>const name = toRef(person,'name')</code></p></li> <li><p>应用:   要将响应式对象中的某个属性单独提供给外部使用时。</p></li> <li><p>扩展：<code>toRefs</code> 与<code>toRef</code>功能一致，但可以批量创建多个 ref 对象，语法：<code>toRefs(person)</code></p></li></ul> <h2 id="三、其它-composition-api"><a href="#三、其它-composition-api" class="header-anchor">#</a> 三、其它 Composition API</h2> <h3 id="_1-shallowreactive-与-shallowref"><a href="#_1-shallowreactive-与-shallowref" class="header-anchor">#</a> 1.shallowReactive 与 shallowRef</h3> <ul><li><p>shallowReactive：只处理对象最外层属性的响应式（浅响应式）。</p></li> <li><p>shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。</p></li> <li><p>什么时候使用?</p> <ul><li>如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive。</li> <li>如果有一个对象数据，后续功能不会修改该对象中的属性，而是生成新的对象来替换 ===&gt; shallowRef。</li></ul></li></ul> <h3 id="_2-readonly-与-shallowreadonly"><a href="#_2-readonly-与-shallowreadonly" class="header-anchor">#</a> 2.readonly 与 shallowReadonly</h3> <ul><li>readonly: 让一个响应式数据变为只读的（深只读）。</li> <li>shallowReadonly：让一个响应式数据变为只读的（浅只读）。</li> <li>应用场景: 不希望数据被修改时。</li></ul> <h3 id="_3-toraw-与-markraw"><a href="#_3-toraw-与-markraw" class="header-anchor">#</a> 3.toRaw 与 markRaw</h3> <ul><li>toRaw：
<ul><li>作用：将一个由<code>reactive</code>生成的<strong style="color:orange;">响应式对象</strong>转为<strong style="color:orange;">普通对象</strong>。是把响应式对象复制一份数据，让这个数据变成普通对象, 就是不改变原对象, 返回值就是普通对象。</li> <li>使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。</li></ul></li> <li>markRaw：
<ul><li>作用：标记一个对象，使其永远不会再成为响应式对象。</li> <li>应用场景:
<ol><li>有些值不应被设置为响应式的，例如复杂的第三方类库等。</li> <li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。</li></ol></li></ul></li></ul> <h3 id="_4-customref"><a href="#_4-customref" class="header-anchor">#</a> 4.customRef</h3> <ul><li><p>作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。</p></li> <li><p>实现防抖效果：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>keyword<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>{{keyword}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>customRef<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
	<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Demo'</span><span class="token punctuation">,</span>
		<span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// let keyword = ref('hello') //使用Vue准备好的内置ref</span>
			<span class="token comment">//自定义一个myRef</span>
			<span class="token keyword">function</span> <span class="token function">myRef</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span>delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> timer
				<span class="token comment">//通过customRef去实现自定义</span>
				<span class="token keyword">return</span> <span class="token function">customRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track<span class="token punctuation">,</span>trigger</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">return</span> <span class="token punctuation">{</span>
						<span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//告诉Vue这个value值是需要被“追踪”的</span>
                                <span class="token keyword">return</span> value
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token comment">// 防抖</span>
                                <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
                                timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                                    value <span class="token operator">=</span> newValue
                                    <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//告诉Vue去更新界面</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
                            <span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">let</span> keyword <span class="token operator">=</span> <span class="token function">myRef</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token comment">//使用程序员自定义的ref</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				keyword
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="_5-provide-与-inject"><a href="#_5-provide-与-inject" class="header-anchor">#</a> 5. provide 与 inject</h3> <ul><li><p>作用：实现<strong style="color:#DD5145;">祖与后代组件间</strong>通信</p></li> <li><p>套路：父组件有一个 <code>provide</code> 选项来提供数据，后代组件有一个 <code>inject</code> 选项来开始使用这些数据</p></li> <li><p>具体写法：</p> <ol><li><p>祖组件中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token operator">...</span>
    <span class="token keyword">let</span> car <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'奔驰'</span><span class="token punctuation">,</span><span class="token literal-property property">price</span><span class="token operator">:</span><span class="token string">'40万'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'car'</span><span class="token punctuation">,</span>car<span class="token punctuation">)</span>
    <span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>后代组件中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token operator">...</span>
    <span class="token keyword">const</span> car <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'car'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>car<span class="token punctuation">}</span>
	<span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol></li></ul> <h3 id="_6-响应式数据的判断"><a href="#_6-响应式数据的判断" class="header-anchor">#</a> 6.响应式数据的判断</h3> <ul><li>isRef: 检查一个值是否为一个 ref 对象</li> <li>isReactive: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</li> <li>isReadonly: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</li> <li>isProxy: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理</li></ul> <h2 id="四、composition-api-的优势"><a href="#四、composition-api-的优势" class="header-anchor">#</a> 四、Composition API 的优势</h2> <h3 id="_1-options-api-存在的问题"><a href="#_1-options-api-存在的问题" class="header-anchor">#</a> 1.Options API 存在的问题</h3> <p>使用传统OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 。</p> <p><img src="/notes/imgs/vue/options-1.png" style="zoom:67%;"><img src="/notes/imgs/vue/options-2.png" style="zoom:67%;"></p> <h3 id="_2-composition-api-的优势"><a href="#_2-composition-api-的优势" class="header-anchor">#</a> 2.Composition API 的优势</h3> <p>我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起。</p> <p><img src="/notes/imgs/vue/composition1.png" style="zoom:67%;"><img src="/notes/imgs/vue/composition2.png" style="zoom:67%;"></p> <h2 id="五、新的组件"><a href="#五、新的组件" class="header-anchor">#</a> 五、新的组件</h2> <h3 id="_1-fragment"><a href="#_1-fragment" class="header-anchor">#</a> 1.Fragment</h3> <ul><li>在Vue2中: 组件必须有一个根标签</li> <li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li> <li>好处: 减少标签层级, 减小内存占用</li></ul> <h3 id="_2-teleport"><a href="#_2-teleport" class="header-anchor">#</a> 2.Teleport</h3> <ul><li><p>什么是Teleport？—— <code>Teleport</code> 是一种能够将我们的<strong style="color:#DD5145;">组件html结构</strong>移动到指定位置的技术。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>teleport</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>移动位置（可以是#id或者直接用标签html、body）<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mask<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>我是一个弹窗<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow = false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>关闭弹窗<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>teleport</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="_3-suspense"><a href="#_3-suspense" class="header-anchor">#</a> 3.Suspense</h3> <ul><li><p>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</p> <ul><li>同步组件：A组件中包含一个B组件，B组件未渲染完成时整个A都不显示</li> <li>异步组件：A组件中包含一个异步组件B，B组件未渲染完成时A中B不占位</li></ul> <p>解决异步组件的问题可以使用Suspense，常见的使用场景：B组件未渲染时显示loading提示</p></li> <li><p>使用步骤：</p> <ul><li><p>异步引入组件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineAsyncComponent<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> Child <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./components/Child.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>使用<code>Suspense</code>包裹组件，并配置好<code>default</code> 与 <code>fallback</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>我是App组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Suspense</span><span class="token punctuation">&gt;</span></span>
            // 这里的default不允许修改
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>default</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span><span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>fallback</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>加载中.....<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Suspense</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li></ul> <h2 id="六、其他"><a href="#六、其他" class="header-anchor">#</a> 六、其他</h2> <h3 id="_1-全局api的转移"><a href="#_1-全局api的转移" class="header-anchor">#</a> 1.全局API的转移</h3> <ul><li><p>Vue 2.x 有许多全局 API 和配置。</p> <ul><li><p>例如：注册全局组件、注册全局指令等。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//注册全局组件</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'MyButton'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;button @click=&quot;count++&quot;&gt;Clicked {{ count }} times.&lt;/button&gt;'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//注册全局指令</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">inserted</span><span class="token operator">:</span> <span class="token parameter">el</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>Vue3.0中对这些API做出了调整：</p> <ul><li><p>将全局的API，即：<code>Vue.xxx</code>调整到应用实例（<code>app</code>）上</p> <table><thead><tr><th>2.x 全局 API（<code>Vue</code>）</th> <th>3.x 实例 API (<code>app</code>)</th></tr></thead> <tbody><tr><td>Vue.config.xxxx</td> <td>app.config.xxxx</td></tr> <tr><td>Vue.config.productionTip</td> <td><strong style="color:#DD5145;">移除</strong></td></tr> <tr><td>Vue.component</td> <td>app.component</td></tr> <tr><td>Vue.directive</td> <td>app.directive</td></tr> <tr><td>Vue.mixin</td> <td>app.mixin</td></tr> <tr><td>Vue.use</td> <td>app.use</td></tr> <tr><td>Vue.prototype</td> <td>app.config.globalProperties</td></tr></tbody></table></li></ul></li></ul> <h3 id="_2-其他改变"><a href="#_2-其他改变" class="header-anchor">#</a> 2.其他改变</h3> <ul><li><p>data选项应始终被声明为一个函数。</p></li> <li><p>过度类名的更改：</p> <ul><li><p>Vue2.x写法</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.v-enter,
.v-leave-to</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.v-leave,
.v-enter-to</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Vue3.x写法</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.v-enter-from,
.v-leave-to</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.v-leave-from,
.v-enter-to</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p><strong style="color:#DD5145;">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持<code>config.keyCodes</code></p></li> <li><p><strong style="color:#DD5145;">移除</strong><code>v-on.native</code>修饰符</p> <ul><li><p>父组件中绑定事件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-component</span>
  <span class="token attr-name"><span class="token namespace">v-on:</span>close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleComponentEvent<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleNativeClickEvent<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li><p>子组件中声明自定义事件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">emits</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li> <li><p><strong style="color:#DD5145;">移除</strong>过滤器（filter）</p> <blockquote><p>过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。</p></blockquote></li> <li><p>......</p></li></ul> <h2 id="vue3-setup语法糖"><a href="#vue3-setup语法糖" class="header-anchor">#</a> vue3 setup语法糖</h2> <h3 id="基础用法"><a href="#基础用法" class="header-anchor">#</a> 基础用法</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;=============&quot;</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="data和methods"><a href="#data和methods" class="header-anchor">#</a> data和methods</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{obj.key}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>log<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>打印日志<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;======log&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="计算属性"><a href="#计算属性" class="header-anchor">#</a> 计算属性</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>计数：{{ countPlus }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>；
<span class="token keyword">const</span> countPlus <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>；
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h3 id="watch-watcheffect"><a href="#watch-watcheffect" class="header-anchor">#</a> watch/watchEffect</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>改变count<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token comment">// 监听ref</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改后'</span><span class="token punctuation">,</span> newVal<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改前'</span><span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听reactive属性</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">,</span>     <span class="token comment">// 一个函数，返回监听属性</span>
    <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改后'</span><span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改前'</span><span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>     <span class="token comment">// 立即执行，默认为false</span>
        <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span>     <span class="token comment">// 深度监听，默认为false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
    
<span class="token comment">// watchEffect</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改后'</span><span class="token punctuation">,</span> count<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改后'</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    count<span class="token punctuation">.</span>value<span class="token operator">++</span>
    obj<span class="token punctuation">.</span>count<span class="token operator">++</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="声明props和emits"><a href="#声明props和emits" class="header-anchor">#</a> 声明props和emits</h3> <div class="language-vue extra-class"><pre class="language-vue"><code>// Child.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>信息：{{ info }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// 声明props</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 声明emits</span>
<span class="token keyword">const</span> $emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'change'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token string">'child返回值'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

// Parent.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child</span> <span class="token attr-name">:info</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onAction<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'./Child.vue'</span>

<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'hello setup !'</span><span class="token punctuation">)</span>    <span class="token comment">// 响应式变量</span>

<span class="token keyword">const</span> <span class="token function-variable function">onAction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>    <span class="token comment">// child返回值</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="父组件获取子组件的数据"><a href="#父组件获取子组件的数据" class="header-anchor">#</a> 父组件获取子组件的数据</h3> <p>父组件要想通过ref获取子组件的变量或函数，子组件须使用<strong>defineExpose</strong>暴露出去</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// Child.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>信息：{{ info }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> defineExpose <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'I am child'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Function of child'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 暴露属性</span>
<span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    info<span class="token punctuation">,</span>
    onChange
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

// Parent.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>childRef<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onAction<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>获取子值<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'./Child.vue'</span>

<span class="token keyword">const</span> childRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">onAction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>childRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>info<span class="token punctuation">)</span>    <span class="token comment">// I am child</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>childRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// Function of child</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="动态css"><a href="#动态css" class="header-anchor">#</a> 动态css</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">p</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span><span class="token string">'theme.color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h2 id="pinia"><a href="#pinia" class="header-anchor">#</a> Pinia</h2> <p>一个vue的store存储库。</p> <h3 id="与vuex的比较"><a href="#与vuex的比较" class="header-anchor">#</a> 与vuex的比较</h3> <ul><li>去掉了<em>mutations</em></li> <li>不再有 <em>modules</em> 的嵌套结构</li> <li>没有 <em>命名空间模块</em></li></ul> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token function">add</span> pinia
<span class="token comment"># 或者使用 npm</span>
<span class="token function">npm</span> <span class="token function">install</span> pinia
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在main.js中使用</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="定义一个store"><a href="#定义一个store" class="header-anchor">#</a> 定义一个Store</h3> <ul><li><strong>State</strong>: 返回初始状态数据的函数</li> <li><strong>Getters</strong>: 等同于 Store 状态的计算值
<ul><li>可以在getters的方法中使用<code>this</code></li> <li>可以在使用时执行给该方法传值</li></ul></li> <li><strong>Actions</strong>: 方法，用于操作<code>State</code>中的数据</li></ul> <p><strong>可以使用其他store中的数据</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// store/user.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> usePointStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth-store'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pointStore <span class="token operator">=</span> <span class="token function">usePointStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> useUserStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">users</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">doubleCount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>counter <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token function">doubleCountPlusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>doubleCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">getUserById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>id <span class="token operator">===</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">getOtherStore</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> pointStore<span class="token punctuation">.</span>pointId<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> useUserStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/user.js'</span>
    <span class="token keyword">const</span> userStore <span class="token operator">=</span> <span class="token function">useUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取state</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userStore<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 获取getter</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userStore<span class="token punctuation">.</span>doubleCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userStore<span class="token punctuation">.</span>doubleCountPlusOne<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// getter传值</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userStore<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 执行actions</span>
    userStore<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> useUserStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/user.js'</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span>useUserStore<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'counter'</span><span class="token punctuation">,</span> <span class="token string">'doubleCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span>useUserStore<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="改变状态"><a href="#改变状态" class="header-anchor">#</a> 改变状态</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 直接修改</span>
store<span class="token punctuation">.</span>counter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// $patch</span>
store<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>counter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 整个替换state</span>
store<span class="token punctuation">.</span>$state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="面试题"><a href="#面试题" class="header-anchor">#</a> 面试题</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/vue/Vue的一些高级用法.html" class="prev">
        vue2的一些高级用法
      </a></span> <span class="next"><a href="/notes/vue/Vue-Router.html">
        vue-router
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.618cb3ee.js" defer></script><script src="/notes/assets/js/2.c60e90e7.js" defer></script><script src="/notes/assets/js/17.87ca5149.js" defer></script>
  </body>
</html>
