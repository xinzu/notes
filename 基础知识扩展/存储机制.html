<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据存储 # | yh的学习文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/notes/assets/css/0.styles.aa6162e3.css" as="style"><link rel="preload" href="/notes/assets/js/app.1087d36c.js" as="script"><link rel="preload" href="/notes/assets/js/2.c60e90e7.js" as="script"><link rel="preload" href="/notes/assets/js/25.34ef620c.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.01fa8667.js"><link rel="prefetch" href="/notes/assets/js/11.c88f7c00.js"><link rel="prefetch" href="/notes/assets/js/12.6db8237b.js"><link rel="prefetch" href="/notes/assets/js/13.b0676ec3.js"><link rel="prefetch" href="/notes/assets/js/14.e0842cc7.js"><link rel="prefetch" href="/notes/assets/js/15.cfd3f1d4.js"><link rel="prefetch" href="/notes/assets/js/16.5d640bd3.js"><link rel="prefetch" href="/notes/assets/js/17.ef9feeb2.js"><link rel="prefetch" href="/notes/assets/js/18.9c483fc6.js"><link rel="prefetch" href="/notes/assets/js/19.7195c25f.js"><link rel="prefetch" href="/notes/assets/js/20.8bd4ae2f.js"><link rel="prefetch" href="/notes/assets/js/21.86a01db9.js"><link rel="prefetch" href="/notes/assets/js/22.c55be918.js"><link rel="prefetch" href="/notes/assets/js/23.c7b19a03.js"><link rel="prefetch" href="/notes/assets/js/24.81bbff94.js"><link rel="prefetch" href="/notes/assets/js/26.d6f02773.js"><link rel="prefetch" href="/notes/assets/js/27.1101284c.js"><link rel="prefetch" href="/notes/assets/js/28.97080c1e.js"><link rel="prefetch" href="/notes/assets/js/29.79abbb45.js"><link rel="prefetch" href="/notes/assets/js/3.0cf10e4b.js"><link rel="prefetch" href="/notes/assets/js/30.21217f75.js"><link rel="prefetch" href="/notes/assets/js/31.dea3ce52.js"><link rel="prefetch" href="/notes/assets/js/32.ce5e5d1a.js"><link rel="prefetch" href="/notes/assets/js/33.1b96854a.js"><link rel="prefetch" href="/notes/assets/js/4.b7d0708f.js"><link rel="prefetch" href="/notes/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/notes/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/notes/assets/js/7.03139e79.js"><link rel="prefetch" href="/notes/assets/js/8.547b5cb4.js"><link rel="prefetch" href="/notes/assets/js/9.1de6ed85.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.aa6162e3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">yh的学习文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础知识扩展</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/基础知识扩展/对象.html" class="sidebar-link">对象</a></li><li><a href="/notes/基础知识扩展/对象迭代的方法.html" class="sidebar-link">对象迭代的方法</a></li><li><a href="/notes/基础知识扩展/正则.html" class="sidebar-link">正则</a></li><li><a href="/notes/基础知识扩展/存储机制.html" class="active sidebar-link">存储机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/基础知识扩展/存储机制.html#cookie" class="sidebar-link">Cookie</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/基础知识扩展/存储机制.html#document-cookie" class="sidebar-link">document.cookie</a></li><li class="sidebar-sub-header"><a href="/notes/基础知识扩展/存储机制.html#cookieutil对象" class="sidebar-link">CookieUtil对象</a></li><li class="sidebar-sub-header"><a href="/notes/基础知识扩展/存储机制.html#子cookie" class="sidebar-link">子cookie</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/基础知识扩展/存储机制.html#web存储机制" class="sidebar-link">Web存储机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/基础知识扩展/存储机制.html#storage类型" class="sidebar-link">Storage类型</a></li><li class="sidebar-sub-header"><a href="/notes/基础知识扩展/存储机制.html#sessionstorage对象" class="sidebar-link">sessionStorage对象</a></li><li class="sidebar-sub-header"><a href="/notes/基础知识扩展/存储机制.html#globalstorage" class="sidebar-link">globalStorage</a></li></ul></li></ul></li><li><a href="/notes/基础知识扩展/禁用弹出框后退页面.html" class="sidebar-link">禁用弹出框后退页面</a></li><li><a href="/notes/基础知识扩展/强制360浏览采用哪种内核.html" class="sidebar-link">强制360浏览采用哪种内核</a></li><li><a href="/notes/基础知识扩展/setTimeout.html" class="sidebar-link">setTimeout</a></li><li><a href="/notes/基础知识扩展/单行代码.html" class="sidebar-link">数组-单行代码</a></li><li><a href="/notes/基础知识扩展/宏任务和微任务.html" class="sidebar-link">宏任务和微任务</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/notes/typescript/ts.html" class="sidebar-link">typescript</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具类</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据存储"><a href="#数据存储" class="header-anchor">#</a> 数据存储</h1> <p>需求：</p> <ol><li>已登录状态，复制域名在同一浏览器访问不强制重新登录；</li> <li>同一浏览器可以多用户登录；</li> <li>已登录状态，复制域名在不同浏览器访问强制重新登录；<br>
目前遇到的问题<br>
使用cookie：同一浏览器不能同时登陆两个账号（思路：setCookie时判断）<br>
使用session：同一浏览器也需要重新登录</li></ol> <h2 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h2> <p><strong>js设置cookie时，最好使用encodeURIComponent()对key和value进行编码，其他参数比如expires、path等不需要进行编码</strong></p> <h3 id="document-cookie"><a href="#document-cookie" class="header-anchor">#</a> document.cookie</h3> <p>读：所有的key-value</p> <p>写：在原有cookie后添加（只需要documnt.cookie=&quot;新增cookie=value&quot;）</p> <p>删除：将key值对应的value清空</p> <h3 id="cookieutil对象"><a href="#cookieutil对象" class="header-anchor">#</a> CookieUtil对象</h3> <p><strong>自定义CookieUtil对象</strong></p> <div class="language- extra-class"><pre><code>var CookieUtil = {
    // 设置cookie
    set : function (name, value, expires, domain, path, secure) {
        var cookieText = &quot;&quot;;
        cookieText += encodeURIComponent(name) + &quot;=&quot; + encodeURIComponent(value);
        if (expires instanceof Date) {
            cookieText += &quot;; expires=&quot; + expires.toGMTString();
        }
        if (path) {
            cookieText += &quot;; path=&quot; + path;
        }
        if (domain) {
            cookieText += &quot;; domain=&quot; + domain;
        }
        if (secure) {
            cookieText += &quot;; secure&quot;;
        }
        document.cookie = cookieText;
    },
    // name=value; expires=expiration_time; path=domain_path; domain=domain_name; secure
    // 获取cookie
    get : function (name) {
        var cookieName = encodeURIComponent(name) + &quot;=&quot;,
            cookieStart = document.cookie.indexOf(cookieName),
            cookieValue = &quot;&quot;;
        if (cookieStart &gt; -1) {
            var cookieEnd = document.cookie.indexOf (&quot;;&quot;, cookieStart);
            if (cookieEnd == -1) {
                cookieEnd = document.cookie.length;
            }
            cookieValue = decodeURIComponent(document.cookie.substring(cookieStart + cookieName.length, cookieEnd));
        }
        return cookieValue; 
    },
    // 删除cookie
    unset : function (name, domain, path, secure) {
        this.set(name, &quot;&quot;, Date(0), domain, path, secure);
    }
};
</code></pre></div><h3 id="子cookie"><a href="#子cookie" class="header-anchor">#</a> 子cookie</h3> <p><strong>为了绕开浏览器单域名下的cookie数限制</strong></p> <p>表现形式：key=key1=value1&amp;key2=value2&amp;key3=value3</p> <p><strong>自定义SubCookieUtil对象</strong></p> <div class="language- extra-class"><pre><code>var SubCookieUtil = {

    get: function (name, subName) {
        var subCookies = this.getAll(name);
        if (subCookies) {
            return subCookies[subName];
        } else {
            return null;
        }
    },

    getAll: function (name) {
        var cookieName = encodeURIComponent(name) + &quot;=&quot;,
            cookieStart = document.cookie.indexOf(cookieName),
            cookieValue = null,
            result = {};

        if (cookieStart &gt; -1) {
            var cookieEnd = document.cookie.indexOf(&quot;;&quot;, cookieStart);
            if (cookieEnd == -1) {
                cookieEnd = document.cookie.length;
            }
            cookieValue = document.cookie.substring(cookieStart + cookieName.length, cookieEnd);

            if (cookieValue.length &gt; 0) {
                var subCookies = cookieValue.split(&quot;&amp;&quot;);

                for (var i = 0, len = subCookies.length; i &lt; len; i++) {
                    var parts = subCookies[i].split(&quot;=&quot;);
                    result[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1]);
                }
                return result;
            }
        }
        return null;
    },

    set: function (name, subName, value, expires, path, domain, secure) {
        var subcookies = this.getAll(name) || {};
        subcookies[subName] = value;
        this.setAll(name, subcookies, expires, path, domain, secure);
    },

    setAll: function (name, subcookies, expires, path, domain, secure) {

        var cookieText = encodeURIComponent(name) + &quot;=&quot;;
        var subcookieParts = new Array();

        for (var subName in subcookies) {
            if (subName.length &gt; 0 &amp;&amp; subcookies.hasOwnProperty(subName)) {
                subcookieParts.push(encodeURIComponent(subName) + &quot;=&quot; + encodeURIComponent(subcookies[subName]));
            }
        }

        if (subcookieParts.length &gt; 0) {
            cookieText += subcookieParts.join(&quot;&amp;&quot;);

            if (expires instanceof Date) {
                cookieText += &quot;; expires=&quot; + expires.toGMTString();
            }

            if (path) {
                cookieText += &quot;; path=&quot; + path;
            }

            if (domain) {
                cookieText += &quot;;domain=&quot; + domain;
            }

            if (secure) {
                cookieText += &quot;;secure&quot;;
            }
        } else {
            cookieText += &quot;; expires=&quot; + (new Date(0)).toGMTString();
        }
        document.cookie = cookieText;
    },

    unset: function (name, subName, path, domain, secure) {
        var subcookies = this.getAll(name);
        if (subcookies) {
            delete subcookies[subName];
            this.setAll(name, subcookies, null, path, domain, secure);
        }
    },

    unsetAll: function (name, path, domain, secure) {
        this.setAll(name, null, new Date(0), path, domain, secure);
    }
};
//假设document.cookie=data=name=Nicholas&amp;book=Professional%20JavaScript

//取得全部子cookie
var data = SubCookieUtil.getAll(&quot;data&quot;);
alert(data.name); //&quot;Nicholas&quot;
alert(data.book); //&quot;Professional JavaScript&quot;

//逐个取得子cookie
alert(SubCookieUtil.get(&quot;data&quot;, &quot;name&quot;)); //&quot;Nicholas&quot;
alert(SubCookieUtil.get(&quot;data&quot;, &quot;book&quot;)); //&quot;Professional JavaScript&quot;

//设置两个cookie
SubCookieUtil.set(&quot;data&quot;, &quot;name&quot;, &quot;Nicholas&quot;);
SubCookieUtil.set(&quot;data&quot;, &quot;book&quot;, &quot;Professional JavaScript&quot;);

//设置全部子cookie和失效日期
SubCookieUtil.setAll(&quot;data&quot;, { name: &quot;Nicholas&quot;, book: &quot;Professional Javascript&quot; }, new Data(&quot;January 1, 2010&quot;));

//修改名字的值，并修改cookie的失效日期
SubCookieUtil.set(&quot;data&quot;, &quot;name&quot;, &quot;Michael&quot;, new Date(&quot;February 1, 2010&quot;));
</code></pre></div><h2 id="web存储机制"><a href="#web存储机制" class="header-anchor">#</a> Web存储机制</h2> <h3 id="storage类型"><a href="#storage类型" class="header-anchor">#</a> Storage类型</h3> <ul><li>clear()：删除所有值，不兼容FF</li> <li>getItem(name)：获取name对应的value</li> <li>setItem(name,value)：设置session</li> <li>removeItem(name)：删除name-value</li> <li>key(index)：获取index位置处的name</li></ul> <h3 id="sessionstorage对象"><a href="#sessionstorage对象" class="header-anchor">#</a> sessionStorage对象</h3> <p>存储于某个会话，也就是该数据值保持到浏览器关闭，可以跨越页面刷新而存在。</p> <p><strong>兼容IE8处理</strong>
FF和chrome实现了同步写入；IE为异步写入，会相对较慢（大量数据）。<br>
在IE8中可强制把数据写入磁盘：在设置新数据之前使用begin()方法，并且在所有设置完成之后调用commit()方法。</p> <div class="language- extra-class"><pre><code>//只适用于IE8
sessionStorage.begin();
sessionStorage.name=&quot;Nicholas&quot;;
sessionStorage.book=&quot;Professional JavaScript&quot;;
sessionStorage.commit();
</code></pre></div><h3 id="globalstorage"><a href="#globalstorage" class="header-anchor">#</a> globalStorage</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/基础知识扩展/正则.html" class="prev">
        正则
      </a></span> <span class="next"><a href="/notes/基础知识扩展/禁用弹出框后退页面.html">
        禁用弹出框后退页面
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.1087d36c.js" defer></script><script src="/notes/assets/js/2.c60e90e7.js" defer></script><script src="/notes/assets/js/25.34ef620c.js" defer></script>
  </body>
</html>
